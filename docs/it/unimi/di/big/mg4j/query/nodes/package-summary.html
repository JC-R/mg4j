<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_66) on Sat Nov 28 10:51:57 EST 2015 -->
<title>it.unimi.di.big.mg4j.query.nodes (MG4J (big) 5.4.1)</title>
<meta name="date" content="2015-11-28">
<link rel="stylesheet" type="text/css" href="../../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="it.unimi.di.big.mg4j.query.nodes (MG4J (big) 5.4.1)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../it/unimi/di/big/mg4j/query/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../../../../it/unimi/di/big/mg4j/query/parser/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?it/unimi/di/big/mg4j/query/nodes/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;it.unimi.di.big.mg4j.query.nodes</h1>
<div class="docSummary">
<div class="block">Composite representation for queries</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Query.html" title="interface in it.unimi.di.big.mg4j.query.nodes">Query</a></td>
<td class="colLast">
<div class="block">A node of a composite representing a query.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/QueryBuilderVisitor.html" title="interface in it.unimi.di.big.mg4j.query.nodes">QueryBuilderVisitor</a>&lt;T&gt;</td>
<td class="colLast">
<div class="block">A visitor for a composite query.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/QueryTransformer.html" title="interface in it.unimi.di.big.mg4j.query.nodes">QueryTransformer</a></td>
<td class="colLast">
<div class="block">A strategy for transforming queries.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/AbstractQueryBuilderVisitor.html" title="class in it.unimi.di.big.mg4j.query.nodes">AbstractQueryBuilderVisitor</a>&lt;T&gt;</td>
<td class="colLast">
<div class="block">A <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/QueryBuilderVisitor.html" title="interface in it.unimi.di.big.mg4j.query.nodes"><code>QueryBuilderVisitor</code></a> that
 returns true on all <code>visitPre()</code> methods and does nothing
 on <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/AbstractQueryBuilderVisitor.html#prepare--"><code>AbstractQueryBuilderVisitor.prepare()</code></a>.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/AbstractTermExpander.html" title="class in it.unimi.di.big.mg4j.query.nodes">AbstractTermExpander</a></td>
<td class="colLast">
<div class="block">A <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/QueryTransformer.html" title="interface in it.unimi.di.big.mg4j.query.nodes">query transformer</a> that just requires
 implementing a method that <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/AbstractTermExpander.html#expand-it.unimi.di.big.mg4j.query.nodes.Term-">expands terms</a> (e.g., into
 disjunctive queries).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Align.html" title="class in it.unimi.di.big.mg4j.query.nodes">Align</a></td>
<td class="colLast">
<div class="block">A node representing the alignment of the two iterators.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/And.html" title="class in it.unimi.di.big.mg4j.query.nodes">And</a></td>
<td class="colLast">
<div class="block">A node representing the logical and of the underlying queries.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Annotation.html" title="class in it.unimi.di.big.mg4j.query.nodes">Annotation</a></td>
<td class="colLast">
<div class="block">A node representing a low-pass filtering of the only underlying query.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/CheckForSelectQueryVisitor.html" title="class in it.unimi.di.big.mg4j.query.nodes">CheckForSelectQueryVisitor</a></td>
<td class="colLast">
<div class="block">A <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/QueryBuilderVisitor.html" title="interface in it.unimi.di.big.mg4j.query.nodes"><code>QueryBuilderVisitor</code></a> that
 returns <a href="http://download.oracle.com/javase/6/docs/api/java/lang/Boolean.html?is-external=true#FALSE" title="class or interface in java.lang"><code>Boolean.FALSE</code></a> only if the visited query contains a <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Select.html" title="class in it.unimi.di.big.mg4j.query.nodes"><code>Select</code></a> node
 that does not lie in the aligner of an <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Align.html" title="class in it.unimi.di.big.mg4j.query.nodes"><code>Align</code></a> query (as in that case
 the index is not part of the answer).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Composite.html" title="class in it.unimi.di.big.mg4j.query.nodes">Composite</a></td>
<td class="colLast">
<div class="block">A abstract composite node containing an array of component queries.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Consecutive.html" title="class in it.unimi.di.big.mg4j.query.nodes">Consecutive</a></td>
<td class="colLast">
<div class="block">A node representing the consecutive composition of the underlying queries.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Containment.html" title="class in it.unimi.di.big.mg4j.query.nodes">Containment</a></td>
<td class="colLast">
<div class="block">A node representing the containment of two queries.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Difference.html" title="class in it.unimi.di.big.mg4j.query.nodes">Difference</a></td>
<td class="colLast">
<div class="block">A node representing a difference of two queries.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/False.html" title="class in it.unimi.di.big.mg4j.query.nodes">False</a></td>
<td class="colLast">
<div class="block">A node representing falseness (i.e., no documents are returned).</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Inclusion.html" title="class in it.unimi.di.big.mg4j.query.nodes">Inclusion</a></td>
<td class="colLast">
<div class="block">A node representing the inclusion of two queries.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/LowPass.html" title="class in it.unimi.di.big.mg4j.query.nodes">LowPass</a></td>
<td class="colLast">
<div class="block">A node representing a low-pass filtering of the only underlying query.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/MultiIndexTermExpander.html" title="class in it.unimi.di.big.mg4j.query.nodes">MultiIndexTermExpander</a></td>
<td class="colLast">
<div class="block">A term expander that replaces every term or prefix with a disjunction of
  queries; each query is made by the same term or prefix 
  preceded by a selection over a different index.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/MultiTerm.html" title="class in it.unimi.di.big.mg4j.query.nodes">MultiTerm</a></td>
<td class="colLast">
<div class="block">A node representing a virtual term obtained by merging the occurrences of the given (possibly weighted) terms.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Not.html" title="class in it.unimi.di.big.mg4j.query.nodes">Not</a></td>
<td class="colLast">
<div class="block">A node representing the logical not of the underlying query.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Or.html" title="class in it.unimi.di.big.mg4j.query.nodes">Or</a></td>
<td class="colLast">
<div class="block">A node representing the logical or of the underlying queries.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/OrderedAnd.html" title="class in it.unimi.di.big.mg4j.query.nodes">OrderedAnd</a></td>
<td class="colLast">
<div class="block">A node representing the logical ordered and of the underlying queries.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Prefix.html" title="class in it.unimi.di.big.mg4j.query.nodes">Prefix</a></td>
<td class="colLast">
<div class="block">A node representing a set of terms defined by a common prefix.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Queries.html" title="class in it.unimi.di.big.mg4j.query.nodes">Queries</a></td>
<td class="colLast">
<div class="block">Static methods and objects related to queries.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Range.html" title="class in it.unimi.di.big.mg4j.query.nodes">Range</a></td>
<td class="colLast">
<div class="block">A node representing a range query on a payload-only index.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Remap.html" title="class in it.unimi.di.big.mg4j.query.nodes">Remap</a></td>
<td class="colLast">
<div class="block">A node representing an index remapping.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Select.html" title="class in it.unimi.di.big.mg4j.query.nodes">Select</a></td>
<td class="colLast">
<div class="block">A node representing an index selection.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Term.html" title="class in it.unimi.di.big.mg4j.query.nodes">Term</a></td>
<td class="colLast">
<div class="block">A node representing a single term.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/True.html" title="class in it.unimi.di.big.mg4j.query.nodes">True</a></td>
<td class="colLast">
<div class="block">A node representing truth (i.e., all documents are returned with interval iterator <a href="../../../../../../../it/unimi/di/big/mg4j/search/IntervalIterators.html#TRUE"><code>IntervalIterators.TRUE</code></a>).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Weight.html" title="class in it.unimi.di.big.mg4j.query.nodes">Weight</a></td>
<td class="colLast">
<div class="block">A node representing a weight selection.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Exception Summary table, listing exceptions, and an explanation">
<caption><span>Exception Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Exception</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/QueryBuilderVisitorException.html" title="class in it.unimi.di.big.mg4j.query.nodes">QueryBuilderVisitorException</a></td>
<td class="colLast">
<div class="block">A wrapper for unchecked exceptions thrown during a visit.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package it.unimi.di.big.mg4j.query.nodes Description">Package it.unimi.di.big.mg4j.query.nodes Description</h2>
<div class="block"><h1>Composite representation for queries</h1>

    <p>This package contains the classes that represent queries as
    an <em>abstract syntax tree</em>, or, in design-pattern jargon, as a <em>composite</em>.
    
    <p><strong>Warning: </strong> Before reading this overview, the reader is encouraged to consult the first part 
    of the <a href="../../../../../../../it/unimi/di/big/mg4j/search/package-summary.html"><code>it.unimi.di.big.mg4j.search</code></a> package
    documentation, where the notion of query is briefly presented. 
    
    <p>The basic idea is to perform a complete decoupling of the query construction and
    resolution into three levels:
        <ul>
                        <li><em>String level</em>: the query is a string, written in a suitable language where, for example, every operator has a 
                        certain syntax, uses a certain keyword etc.</li>
                        <li><em>Tree level</em>: the query is an abstract tree, that contains one internal node for each operator, but that has
                        nothing to do with the actual way the query was written; for example, one may want to give the user the possibility
                        to write the query by using a visual editor, in which case there will be some way to obtain the tree representation
                        of the query without having any string-level representation for it.</li>
                        <li><em>Iterator level</em>: the document iterator that lazily solves the query over a certain index or set of indices;
                        this is the semantic counterpart of a query, and it is discussed at large in the overview of the <a href="../../../../../../../it/unimi/di/big/mg4j/search/package-summary.html"><code>it.unimi.di.big.mg4j.search</code></a>
                        package.</li>           
        </ul>
    
    <P>This package overview shows how to pass from the string to the tree level using the built-in
    <a href="../../../../../../../it/unimi/di/big/mg4j/query/parser/QueryParser.html" title="interface in it.unimi.di.big.mg4j.query.parser"><code>QueryParser</code></a>, and explains what is needed to implement the tree level, as well as the basic instruments
    needed to convert the tree level into the iterator level. 

     <p>In MG4J, a query parser is an implementation of <a href="../../../../../../../it/unimi/di/big/mg4j/query/parser/QueryParser.html" title="interface in it.unimi.di.big.mg4j.query.parser"><code>QueryParser</code></a>:
     essentially, an object with a method that transforms strings in <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Query.html" title="interface in it.unimi.di.big.mg4j.query.nodes">queries</a>.
     You can use any parser you like, or build your queries programmatically.

      <P>The parser provided with MG4J and whose syntax is 
      described in the manual is currently generated using <a
      href="https://javacc.dev.java.net/">JavaCC</a>: unfortunately, this tool
      produces some public classes that somehow clutter the package
      documentation.  All the parsing logic is contained in the
      <a href="../../../../../../../it/unimi/di/big/mg4j/query/parser/SimpleParser.html" title="class in it.unimi.di.big.mg4j.query.parser"><code>SimpleParser</code></a> class, which is generated by the
      JavaCC source <samp>SimpleParser.jj</samp>.

        <h2>Building a query tree out of a query string</h2>
        
        <P>MG4J allows one to perform queries on <em>multiple indices</em>; by saying so, we mean that
                you may have many indices concerning the same document collection, and you want to perform
                a query that may search on some of them. Think, for example, of a collection of emails.
                You might have generated a number of indices, to index their subjects, sender, recipient(s), 
                body etc. All these indices can be thought of as individual entities, their only relation being
                that they index collections with the same number of documents, and that same-numbered documents
                conceptually "come" from the same source. 
                
         <P>To get a query tree from a string representation, you must first build a <a href="../../../../../../../it/unimi/di/big/mg4j/query/parser/QueryParser.html" title="interface in it.unimi.di.big.mg4j.query.parser"><code>QueryParser</code></a> object.
         For instance, if you use the built-in <a href="../../../../../../../it/unimi/di/big/mg4j/query/parser/SimpleParser.html" title="class in it.unimi.di.big.mg4j.query.parser"><code>SimpleParser</code></a> you have
         to provide a map whose keys are index names (called <em>index aliases</em>) and
                with each index alias mapped to the corresponding <a href="../../../../../../../it/unimi/di/big/mg4j/index/Index.html" title="class in it.unimi.di.big.mg4j.index"><code>Index</code></a>. 
                Moreover, one of the aliases is taken to be the <em>default index alias</em> used for the queries.
                
         <P>In our example, we will assume that we have three index aliases (say, <samp>subject</samp>,
                <samp>from</samp> and <samp>body</samp>), and that <samp>subject</samp> is the
                default index alias.
                The parser would then be created as follows (here, we are stipulating that index with alias
                <samp>x</samp> has basename <samp>mail-x</samp>):
                
                <PRE>
                Object2ReferenceMap&lt;String,Index&gt; indexAlias2Index = new Object2ReferenceOpenHashMap&lt;String,Index&gt;();
                Index defaultIndex;
                indexAlias2Index.put( "subject", defaultIndex = Index.getInstance( "mail-subject" ) );
                indexAlias2Index.put( "from", Index.getInstance( "mail-from" ) );
                indexAlias2Index.put( "body", Index.getInstance( "mail-body" ) );
                
                QueryParser parser = new QueryParser( indexAlias2Index.keySet(), "subject" );
                </PRE>
                
                after which you can use it for example as follows:
                
                <pre>
                        Query query = parser.parse( "meeting AND body:(schedule OR urgent)" );
                        DocumentIteratorBuilderVisitor visitor = new DocumentIteratorBuilderVisitor( indexAlias2Index, defaultIndex, 0 );
                        DocumentIterator it = query.accept( visitor );
                        while ( it.hasNext() ) {
                                System.out.println( "Document #: " + it.nextDocument() );
                                System.out.print( "\tPositions:" );
                                for ( Interval interval: it )
                                        System.out.print( " " + interval );
                                System.out.println();
                        }
                </pre>
        
    <h2>Structure of a <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Query.html" title="interface in it.unimi.di.big.mg4j.query.nodes"><code>Query</code></a></h2>
    
    <P>As explained above, in this package a <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Query.html" title="interface in it.unimi.di.big.mg4j.query.nodes"><code>Query</code></a> is simply an abstract tree: its leaves will correspond to ground queries, whereas
    internal nodes correspond to query operators.</p>
    
    <P>Ground queries can be <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Term.html" title="class in it.unimi.di.big.mg4j.query.nodes">term queries</a>, <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Prefix.html" title="class in it.unimi.di.big.mg4j.query.nodes">prefix queries</a>,
    <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/MultiTerm.html" title="class in it.unimi.di.big.mg4j.query.nodes">multiterm queries</a> (the latter usually generated by some query-expansion mechanism),
    <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/True.html" title="class in it.unimi.di.big.mg4j.query.nodes"><code>True</code></a> and <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/False.html" title="class in it.unimi.di.big.mg4j.query.nodes"><code>False</code></a>.
    Any other query is either a <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Composite.html" title="class in it.unimi.di.big.mg4j.query.nodes">composite query</a> (e.g.,
    a <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/And.html" title="class in it.unimi.di.big.mg4j.query.nodes">conjunctive query</a>, a <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Or.html" title="class in it.unimi.di.big.mg4j.query.nodes">disjunctive query</a> etc.),
    that is, a query composed by other subqueries, or it is obtained by some other operator (e.g.,
    a <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/LowPass.html" title="class in it.unimi.di.big.mg4j.query.nodes">low-pass query</a> etc.).</p>
    
    <P>The <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Weight.html" title="class in it.unimi.di.big.mg4j.query.nodes">Weight</a> class allows one to assign a weight to a query (it wraps a query and assigns a 
    weight with it; queries that are not assigned a weight explicitly have a default weight of 1). A special treatment is reserved to
    weighted terms (that is, to nodes that are made by applying a <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Weight.html" title="class in it.unimi.di.big.mg4j.query.nodes">Weight</a> to a <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Term.html" title="class in it.unimi.di.big.mg4j.query.nodes">Term</a>:
    they are considered essentially as variants of terms, and so they can be used to build a multiterm query.</P> 
    
    <P>Every query has a method that <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Query.html#accept-it.unimi.di.big.mg4j.query.nodes.QueryBuilderVisitor-">accepts</a> 
    a <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/QueryBuilderVisitor.html" title="interface in it.unimi.di.big.mg4j.query.nodes"><code>QueryBuilderVisitor</code></a> object, through which you can visit the query tree.
    More precisely, when the accept method is invoked on a query, a recursive visit of the query tree is performed: at every
    node <code>n</code> of type <code>Q</code> (<code>Q</code> being any class implementing <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Query.html" title="interface in it.unimi.di.big.mg4j.query.nodes"><code>Query</code></a>), 
    the following steps are performed:
        <ul>
                <li>the visitor's <code>visitPre(Q n)</code> method is called; if the method returns false, the visit is
                interrupted; otherwise&hellip;</li>
                <li>the subtrees are recursively visited, obtaining an array of results <code>T[] x</code>; if at a certain
                point during this visit some call decides that the visit should be interrupted, we stop; otherwise&hellip;</li>
                <li>the visitor's <code>visitPost(Q n, T[] x)</code> method is called, and the result (of type <code>T</code>) 
                is returned.</li>
        </ul>

         <P>To make the idea of a visitor easier to understand, consider the following simple example of a visitor:</p>    
    
        <pre>
                static class PrinterVisitor extends AbstractQueryBuilderVisitor&lt;String> {
                private static void appendArray( MutableString res, String t[], char sep ) {
                        for ( int i = 0; i < t.length - 1; i++ ) res.append( t[ i ] + sep );
                        res.append( t[ t.length - 1 ] );
                }
                public String[] newArray( int len ) { return new String[ len ]; }
                public String visitPost( OrderedAnd node, String[] t ) {
                        MutableString res = new MutableString();
                        res.append( "OAND(" );
                        appendArray( res, t, ',' );
                        res.append( ")" );
                        return res.toString();
                }
                public String visitPost( Or node, String[] t ) {
                        MutableString res = new MutableString();
                        res.append( "OR(" );
                        appendArray( res, t, ',' );
                        res.append( ")" );
                        return res.toString();
                }
                public String visitPost( And node, String[] t ) {
                        MutableString res = new MutableString();
                        res.append( "AND(" );
                        appendArray( res, t, ',' );
                        res.append( ")" );
                        return res.toString();
                }
                public String visitPost( Consecutive node, String[] t ) {
                        MutableString res = new MutableString();
                        res.append( "\"" );
                        appendArray( res, t, ' ' );
                        res.append( "\"" );
                        return res.toString();
                }
                public String visitPost( Not node, String t ) {
                        return "NOT(" + t + ")";
                }
                public String visitPost( LowPass node, String t ) {
                        return t + "~" + node.k;
                }
                public String visitPost( Select node, String t ) {
                        return node.index + ":" + t;
                }
                public String visitPost( Weight node, String t ) {
                                return t + "{" + node.weight + "}";
                }
                public String visit( Term node ) { return node.term.toString(); }
                public String visit( Prefix node ) { return node.prefix + "*"; }
                public String visit( MultiTerm node ) { return node.term.toString(); }
        }
        </pre>

                <P>Now, you can pass an instance of this visitor to a query, and as a result get a string (linear) representation
                of the query itself. (Of course, there is a simple way to get the same result, that is, calling the <code>toString()</code>
                method directly, but for this example is easy enough for illustrative purposes.)</p>
                
                <p>Here is an example of how the above visitor can be used:</p>
  
                <pre>
          public static void main( String arg[] ) throws Exception {
                Query qa = new Term( "a" );
                Query qb = new Prefix( "b" );
                Query qc = new Term( "c" );
                Query qd = new Term( "d" );

                Query q = new LowPass( new And( qa, new Select( "another_index", qb ), new Or( qc, qd ) ), 20 );

                System.out.println( q.accept( new PrinterVisitor() ) );
        }
                </pre>
                
                that produces <tt>AND(a,another_index:b*,OR(c,d))~20</tt>.  
                
                <h2>Building a document iterator out of a query</h2>
                
                <p>The interface <a href="../../../../../../../it/unimi/di/big/mg4j/query/nodes/Query.html" title="interface in it.unimi.di.big.mg4j.query.nodes"><code>Query</code></a> and its implementations provide the basic classes
                for the tree-level representation of a query. Building an iterator out of it can be thought of as a process of recursive
                instantiation of a query tree into an iterator tree; this is actually a sort of a copy visit, and it is indeed implemented
                as a special kind of visitor: the <a href="../../../../../../../it/unimi/di/big/mg4j/search/DocumentIteratorBuilderVisitor.html" title="class in it.unimi.di.big.mg4j.search"><code>DocumentIteratorBuilderVisitor</code></a>.
                You can create one such visitor and use it to visit a query tree, obtaining as a result a document iterator
                that you can use to get the results.
                </p>            
                
                <p>To be more precise, let us recall the example presented in the last part of the <a href="../../../../../../../it/unimi/di/big/mg4j/search/package-summary.html">overview of the search package</a>:</p>           
                
                <PRE>
                        Index subjectIndex = Index.getInstance( "mail-subject" );
                        DocumentIterator it = AndDocumentIterator.getInstance( 
                                subjectIndex.documents( "meeting" ), 
                                subjectIndex.documents( "schedule" ), 
                                subjectIndex.documents( "monday" ) 
                        );
                        while ( it.hasNext() ) {
                                        System.out.println( "Document #: " + it.nextDocument() );
                                        System.out.print( "\tPositions:" );
                                        for ( Interval interval: it )
                                                System.out.print( " " + interval );
                                        System.out.println();
                        }
                </PRE>
                
                <p>Here is an equivalent piece of code that uses the idea of decoupling the tree level from the iterator level.</p>

                <PRE>
                        Index subjectIndex = Index.getInstance( "mail-subject" );
                        Query q = new And( new Term( "meeting" ), new Term( "schedule" ), new Term( "monday" ) );
                        DocumentIteratorBuilderVisitor visitor = new DocumentIteratorBuilderVisitor( null, subjectIndex, 0 );
                        DocumentIterator it = q.accept( visitor );
                        while ( it.hasNext() ) {
                                System.out.println( "Document #: " + it.nextDocument() );
                                System.out.print( "\tPositions:" );
                                for ( Interval interval: it )
                                        System.out.print( " " + interval );
                                System.out.println();
                        }
                </PRE></div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../../it/unimi/di/big/mg4j/query/package-summary.html">Prev&nbsp;Package</a></li>
<li><a href="../../../../../../../it/unimi/di/big/mg4j/query/parser/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../../index.html?it/unimi/di/big/mg4j/query/nodes/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
